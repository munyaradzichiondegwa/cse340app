<main>
    <h1>
        <%= title %>
    </h1>

    <% if (message) { %>
        <div class="flash-message">
            <%= message %>
        </div>
        <% } %>

            <!-- 🔔 Show all validation errors if present -->
            <% if (errors) { %>
                <ul class="notice">
                    <% errors.array().forEach(error=> { %>
                        <li>
                            <%= error.msg %>
                        </li>
                        <% }) %>
                </ul>
                <% } %>

                    <form action="/account/register" method="post" class="form-card">
                        <label for="firstname">First Name</label>
                        <input type="text" id="firstname" name="firstname" required
                            value="<%= typeof locals.firstname != 'undefined' ? locals.firstname : '' %>">

                        <label for="lastname">Last Name</label>
                        <input type="text" id="lastname" name="lastname" required
                            value="<%= typeof locals.lastname != 'undefined' ? locals.lastname : '' %>">

                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" required
                            value="<%= typeof locals.email != 'undefined' ? locals.email : '' %>">

                        <label for="password">Password</label>
                        <div class="password-requirements">
                            Passwords must be at least <strong>12 characters</strong> and contain at least:
                            <ul>
                                <li>1 uppercase letter</li>
                                <li>1 number</li>
                                <li>1 special character</li>
                            </ul>
                        </div>

                        <div class="password-toggle-wrapper">
                            <input type="password" id="password" name="password" required
                                pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{12,}$"
                                title="Must be at least 12 characters with at least 1 number, 1 uppercase letter, and 1 special character">
                            <button type="button" id="togglePassword"
                                aria-label="Toggle Password Visibility">👁️</button>
                        </div>

                        <button type="submit">Register</button>
                    </form>
</main>

<script>
    const togglePassword = document.getElementById("togglePassword")
    const passwordInput = document.getElementById("password")

    togglePassword.addEventListener("click", () => {
        const type = passwordInput.getAttribute("type") === "password" ? "text" : "password"
        passwordInput.setAttribute("type", type)
        togglePassword.textContent = type === "password" ? "👁️" : "🙈"
    })
</script>